#! /usr/bin/python
# -*- coding: utf-8 -*-

import sys
import os

BASE_DIR = os.path.abspath( os.path.join( os.path.dirname( __file__ ), ".." ) )
path     = os.path.abspath( os.path.join( BASE_DIR, "python" ) )
sys.path.append( path )

import momo
import numpy as np


def learn( name, cost_function ):
  f = open( name, "w" )
  cost_function.save( f )
  f.close()


if not os.path.exists( "models" ):
  os.makedirs( "models" )

data     = momo.read_data( sys.argv[1] )
features = momo.features.__dict__[sys.argv[2]] 
cost_function = momo.cost_functions.__dict__[sys.argv[3]]

output_name = "models/%s_%s_%s.txt" % ( 
  sys.argv[1].split( "/" )[-1].split( "." )[0], sys.argv[2], sys.argv[3] 
) 

learn( 
  output_name,
  cost_function( features, data )
)

cf = momo.cost_functions.mahalanobis.load( open( output_name ) )

